<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>body_soil.jl · Soil dynamics simulator</title><meta name="title" content="body_soil.jl · Soil dynamics simulator"/><meta property="og:title" content="body_soil.jl · Soil dynamics simulator"/><meta property="twitter:title" content="body_soil.jl · Soil dynamics simulator"/><meta name="description" content="Documentation for Soil dynamics simulator."/><meta property="og:description" content="Documentation for Soil dynamics simulator."/><meta property="twitter:description" content="Documentation for Soil dynamics simulator."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Soil dynamics simulator</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../types/">types.jl</a></li><li><a class="tocitem" href="../grid/">Grid</a></li><li><a class="tocitem" href="../bucket/">bucket.jl</a></li><li class="is-active"><a class="tocitem" href>body_soil.jl</a><ul class="internal"><li><a class="tocitem" href="#Introductory-remarks"><span>Introductory remarks</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../intersecting_cells/">intersecting_cells.jl</a></li><li><a class="tocitem" href="../relax/">relax.jl</a></li><li><a class="tocitem" href="../utils/">utils.jl</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>body_soil.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>body_soil.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/KennyVilella/soil_dynamics_julia" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/KennyVilella/soil_dynamics_julia/blob/main/docs/src/body_soil.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Documentation-for-body_soil.jl"><a class="docs-heading-anchor" href="#Documentation-for-body_soil.jl">Documentation for body_soil.jl</a><a id="Documentation-for-body_soil.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-for-body_soil.jl" title="Permalink"></a></h1><h2 id="Introductory-remarks"><a class="docs-heading-anchor" href="#Introductory-remarks">Introductory remarks</a><a id="Introductory-remarks-1"></a><a class="docs-heading-anchor-permalink" href="#Introductory-remarks" title="Permalink"></a></h2><p>The function in this file has two important purposes:</p><ul><li>Moving the soil resting on the excavator bucket following the bucket&#39;s movement.</li><li>Collecting the locations of the bucket soil and storing them in <code>out.body_soil_pos</code>.</li></ul><p>While these tasks may initially appear straightforward, they are, in fact, quite complex due to the limited information available and the need to handle edge cases where soil from different locations ends up in the same position.</p><p>The first task of the function is to determine the new position of the bucket soil following the bucket&#39;s movement. This process involves several steps to accurately calculate the soil&#39;s new resting position:</p><ul><li>The algorithm starts by taking the current position of the bucket where the soil is resting and calculates the corresponding position in the reference pose of the bucket.</li><li>Next, the algorithm applies the updated bucket pose to this reference position to determine the new position where the bucket soil should now be resting.</li></ul><p>This process is necessary because the orientation of the bucket is given relative to its reference pose.</p><p>The second task is to determine the appropriate bucket layer where the soil should be placed. As it is assumed that the bucket movement between two steps is less than <code>cell_size_xy</code>, the soil is moved to the bucket layer that is within a vertical distance of <code>cell_size_xy</code> from the newly calculated position. However, there can be complications, especially when <code>cell_size_z</code> is significantly lower than <code>cell_size_xy</code>. In such cases, finding the correct bucket layer with the available information may be challenging. If no bucket layer satisfies the above condition, the soil is moved to the terrain.</p><p>Note that it is crucial that this function is called after <code>_calc_bucket_pos!</code> and that the bucket pose has not yet been updated in the <code>BucketParam</code> struct.</p><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SoilDynamics._update_body_soil!-Union{Tuple{T}, Tuple{I}, Tuple{B}, Tuple{SimOut{B, I, T}, Vector{T}, ReferenceFrameRotations.Quaternion{T}, GridParam{I, T}, BucketParam{T}}, Tuple{SimOut{B, I, T}, Vector{T}, ReferenceFrameRotations.Quaternion{T}, GridParam{I, T}, BucketParam{T}, T}} where {B&lt;:Bool, I&lt;:Int64, T&lt;:Float64}" href="#SoilDynamics._update_body_soil!-Union{Tuple{T}, Tuple{I}, Tuple{B}, Tuple{SimOut{B, I, T}, Vector{T}, ReferenceFrameRotations.Quaternion{T}, GridParam{I, T}, BucketParam{T}}, Tuple{SimOut{B, I, T}, Vector{T}, ReferenceFrameRotations.Quaternion{T}, GridParam{I, T}, BucketParam{T}, T}} where {B&lt;:Bool, I&lt;:Int64, T&lt;:Float64}"><code>SoilDynamics._update_body_soil!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">_update_body_soil!(
    out::SimOut{B,I,T}, pos::Vector{T}, ori::Quaternion{T}, grid::GridParam{I,T},
    bucket::BucketParam{T}, tol::T=1e-8
) where {B&lt;:Bool,I&lt;:Int64,T&lt;:Float64}</code></pre><p>This function moves the soil resting on the bucket following its movement. To do so, the movement applied to the base of the soil column is calculated and the soil is moved to this new location. It is however difficult to track accurately each bucket wall. This is currently done by looking at the height difference between the previous and new soil locations, if this height difference is lower than <code>cell_size_xy</code>, it is assumed to be the same bucket wall. Some errors may however be present and further testing is required. If no bucket wall is present, the soil is moved down to the terrain.</p><p>The new positions of the soil resting on the bucket are collected into <code>out.body_soil_pos</code> and duplicates are removed.</p><p><strong>Note</strong></p><ul><li>This function is intended for internal use only.</li><li>This function is a work in progress. Some optimization and improvements may be needed.</li></ul><p><strong>Inputs</strong></p><ul><li><code>out::SimOut{Bool,Int64,Float64}</code>: Struct that stores simulation outputs.</li><li><code>pos::Vector{Float64}</code>: Cartesian coordinates of the bucket origin. [m]</li><li><code>ori::Quaternion{Float64}</code>: Orientation of the bucket. [Quaternion]</li><li><code>grid::GridParam{Int64,Float64}</code>: Struct that stores information related to the                                   simulation grid.</li><li><code>bucket::BucketParam{Float64}</code>: Struct that stores information related to the                                 bucket object.</li><li><code>tol::Float64</code>: Small number used to handle numerical approximation errors.</li></ul><p><strong>Outputs</strong></p><ul><li>None</li></ul><p><strong>Example</strong></p><pre><code class="nohighlight hljs">pos = [0.5, 0.3, 0.4]
ori = angle_to_quat(0.0, -pi / 2, 0.0, :ZYX)
grid = GridParam(4.0, 4.0, 3.0, 0.05, 0.01)
o = [0.0, 0.0, 0.0]
j = [0.0, 0.0, 0.0]
b = [0.0, 0.0, -0.5]
t = [1.0, 0.0, -0.5]
bucket = BucketParam(o, j, b, t, 0.5)
terrain = zeros(2 * grid.half_length_x + 1, 2 * grid.half_length_y + 1)
out = SimOut(terrain, grid)

_update_body_soil!(out, pos, ori, grid, bucket)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KennyVilella/soil_dynamics_julia/blob/4ae05c47555be2d2b62a7f54cb13dc129f361f66/src/body_soil.jl#L9-L57">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../bucket/">« bucket.jl</a><a class="docs-footer-nextpage" href="../intersecting_cells/">intersecting_cells.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Saturday 23 March 2024 09:54">Saturday 23 March 2024</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
