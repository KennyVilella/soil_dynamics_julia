# Documentation for utils.jl

This file aggregates a collection of utility functions.
Information for some of these functions are provided below.

## Checking functions

This corresponds to the functions `check_volume` and `check_soil`, which can be used to check the validity of the simulation outputs.
It is important to call these functions either before or after the simulation stepping process, as the outputs may be temporarily invalid during the stepping.

The `check_volume` function verifies mass conservation, ensuring that the total mass of soil is properly conserved throughout the simulation. 
The `check_soil` function checks the coherence and integrity of the terrain, bucket soil, and bucket.
It ensures that there are no intersections or conflicting cell assignments between these three groups.

Note that these functions are computationally intensive and may slow down the simulation.
Therefore, it is recommended to use them primarily for debugging and testing purposes.

## Writing functions

This corresponds to the functions `write_soil` and `write_bucket`, which can be used to write the outputs into csv files.
The `write_bucket` function generates files starting with `bucket`, containing the Cartesian coordinates of the four bucket walls' edges.
Conversely, the `write_soil` function generates files starting with `terrain` for the terrain height and `body_soil` for the bucket soil height.
All the output files are saved in the `results` folder, with sequentially increasing numbers appended to the filenames.

Note that these functions are primarily designed to be used in the example script provided.
Consequently, they have potential limitations that should be considered by the user.
Firstly, the file numbers are assigned sequentially.
If the `write_bucket` and `write_soil` functions are not called together consistently, the file numbers of the `bucket` and `terrain` may not correspond.
Additionally, this may cause issues if existing files are present in the `results` folder.

Secondly, the file formats generated by these functions are specifically designed for visualization with Paraview.
To visualize the data using a different tool, some change to the file formats may be needed.

## `_locate_all_non_zeros`
The purpose of this function is to provide a list of indices corresponding to the non-zero elements of either the `body` or `body_soil` field of the `SimOut` struct.
`body` and `body_soil` are a vector of Sparse Matrices indicating the location of the bucket and bucket soil, respectively.
Sparse Matrices are used to speed up the code and reduce memory allocation, but this function is still slow and should be used only when necessary.

## API
```@autodocs
Modules = [SoilDynamics]
Pages   = ["utils.jl"]
```
